<p>dashboard works!</p>
<app-navbar></app-navbar>

<style>
  .dashboard-content {
    width: 80%; /* Aumentado el ancho del contenido del dashboard */
    margin: auto;
    font-family: 'Arial', sans-serif; /* Fuente más legible */
    color: #333; /* Color de texto más oscuro para mejor contraste */
  }

  .chart-container, .consulta-container, .year-selector {
    background-color: #f9f9f9; /* Fondo ligeramente grisáceo para los contenedores */
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px; /* Bordes redondeados */
    box-shadow: 0 0 10px rgba(0,0,0,0.1); /* Sombra suave */
  }

  h1 {
    color: #2c3e50; /* Color del título principal */
    border-bottom: 2px solid #2c3e50; /* Línea inferior para el título */
    padding-bottom: 0.5em;
    margin-bottom: 1em;
  }

  h2 {
    color: #3498db; /* Color de los subtítulos */
    margin-top: 0;
  }

  .year-selector label, .consulta-container label {
    margin-right: 10px;
    font-weight: bold;
  }

  .year-selector select, .consulta-container select {
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ddd;
  }

  .chart-container {
    text-align: center; /* Centrar el texto dentro de los contenedores de gráficos */
  }

  .consulta-container table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  .consulta-container th, .consulta-container td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: right; /* Alinear el texto a la derecha en las celdas de la tabla */
  }

  .consulta-container th {
    background-color: #f0f0f0; /* Fondo para las cabeceras de la tabla */
    font-weight: bold;
    text-align: center; /* Centrar los encabezados */
  }

  .consulta-container tbody tr:nth-child(even) {
    background-color: #f2f2f2; /* Filas pares con fondo ligeramente diferente */
  }

  .loading-data {
    text-align: center;
    padding: 20px;
    font-style: italic;
    color: #777;
  }
  /* Estilos para el gráfico de barras */
  .bar-chart-container {
    display: flex;
    flex-direction: column;
    align-items: center; /* Centrar el contenido horizontalmente */
    margin-bottom: 20px; /* Espacio debajo de cada gráfico */
  }

  .bar-chart-container h3 {
    margin-bottom: 15px; /* Espacio debajo del título del gráfico */
    color: #555; /* Color del título del gráfico */
  }


</style>

<div class="dashboard-content">
  <h1>Dashboard</h1>
  <p>Bienvenido al panel de control.</p>

  <div class="year-selector">
    <label for="year">Año:</label>
    <select id="year" [(ngModel)]="selectedYear" (ngModelChange)="onYearChange()">
      <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
    </select>
  </div>

  <div *ngIf="loadingData" class="loading-data">
    Cargando datos...
  </div>

  <div *ngIf="!loadingData" class="chart-container bar-chart-container">
    <h3>Total de Ingresos Mensuales ({{ selectedYear }})</h3>
    <app-bar-chart
      [data]="chartData"
      categoryField="month"
      valueField="total"
      chartTitle="Ingresos por Mes"
    ></app-bar-chart>
  </div>

  <div *ngIf="!loadingData" class="chart-container bar-chart-container">
    <h3>Total de Ingresos por Cliente ({{ selectedYear }})</h3>
    <app-bar-chart
      [data]="chartDataClients"
      categoryField="category"
      valueField="total"
      chartTitle="Ingresos por Cliente"
    ></app-bar-chart>
  </div>

    <div *ngIf="!loadingData" class="chart-container bar-chart-container">
    <h3>Total de Pagos por Proveedor ({{ selectedYear }})</h3>
    <app-bar-chart
      [data]="chartDataIssuers"
      categoryField="category"
      valueField="total"
      chartTitle="Pagos por Proveedor"
    ></app-bar-chart>
  </div>


  <div *ngIf="!loadingData" class="consulta-container">
    <h2>Consulta de Saldos de Facturas</h2>

    <div>
      <label for="periodo">Periodo:</label>
      <select id="periodo" [(ngModel)]="consultaPeriodo" (ngModelChange)="realizarConsulta()">
        <option value="mensual">Mensual</option>
        <option value="trimestral">Trimestral</option>
        <option value="anual">Anual</option>
      </select>
    </div>

    <div *ngIf="resultadosConsulta">
      <h3>Totales {{ consultaPeriodo | titlecase }}</h3>
      <table>
        <thead>
          <tr>
            <th>Periodo</th>
            <th>Base Imponible</th>
            <th>IVA</th>
            <th>IRPF</th>
            <th>Total Factura</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let periodoKey of consultaPeriodoKeys">     <td>{{ periodoKey }}</td>
            <td>{{ resultadosConsulta[periodoKey].baseImponible | number:'1.2-2' }}</td>
            <td>{{ resultadosConsulta[periodoKey].iva | number:'1.2-2' }}</td>
            <td>{{ resultadosConsulta[periodoKey].irpf | number:'1.2-2' }}</td>
            <td>{{ resultadosConsulta[periodoKey].total | number:'1.2-2' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>